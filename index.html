<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-commerce Funnel Simulation</title>
    
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PWL3927F');</script>
    <style>
        /* Απλά styles για να είναι ευδιάκριτα τα βήματα */
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f4; }
        .form-container { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .submit-button { padding: 10px 15px; background-color: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px; }
        .submit-button:hover { opacity: 0.9; }
        .submit-button:disabled { background-color: #ccc; cursor: not-allowed; }
        #checkout-section, #purchase-section { border-left: 5px solid; padding-left: 15px; }
        #checkout-section { border-color: #f39c12; }
        #purchase-section { border-color: #27ae60; }
    </style>
</head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PWL3927F"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div class="header-container">
        <h1>E-commerce Funnel Simulation (GTM Test)</h1>
        <p>Πατήστε τα κουμπιά με τη σειρά για να πυροδοτήσετε τα events στο Data Layer.</p>
    </div>
    
    <div class="product-card form-container">
        <h2>Marketing Package Pro</h2>
        <p>SKU: MKTPKG_PRO_2025</p>
        <p>Τιμή: **€150.00**</p>
        <button id="addToCartButton" class="submit-button">🛒 1. Add to Cart</button>
    </div>

    <div id="checkout-section" class="form-container" style="display: none;">
        <h3>Καλάθι: 1 Προϊόν</h3>
        <button id="checkoutButton" class="submit-button" style="background-color: #f39c12;">➡️ 2. Begin Checkout</button>
    </div>

    <div id="purchase-section" class="form-container" style="display: none;">
        <h3>Ολοκλήρωση</h3>
        <p>Ολοκληρώστε την αγορά σας για να μεταφερθείτε στη σελίδα επιτυχίας.</p>
        <button id="completePurchaseButton" class="submit-button" style="background-color: #27ae60;">✅ 3. Complete Purchase</button>
    </div>

    <script>
        // Δεδομένα Προϊόντος (Απαραίτητα για τα events add_to_cart, begin_checkout και purchase)
        const itemData = {
            'item_id': 'MKTPKG_PRO_2025',
            'item_name': 'Marketing Package Pro',
            'item_category': 'Services',
            'price': 150.00,
            'quantity': 1
        };

        // 1. Add to Cart Event
        document.getElementById('addToCartButton').addEventListener('click', function() {
            // Push 'add_to_cart' event to Data Layer (GTM Enhanced E-commerce Event)
            window.dataLayer.push({
                'event': 'add_to_cart',
                'ecommerce': {
                    'items': [itemData] // Χρησιμοποιεί τα δεδομένα του προϊόντος
                }
            });
            console.log('GTM Event Fired: add_to_cart');
            
            // Προχωράμε στο επόμενο βήμα
            document.getElementById('checkout-section').style.display = 'block';
            this.disabled = true;
        });

        // 2. Begin Checkout Event
        document.getElementById('checkoutButton').addEventListener('click', function() {
            // Push 'begin_checkout' event to Data Layer
            window.dataLayer.push({
                'event': 'begin_checkout',
                'ecommerce': {
                    'items': [itemData]
                }
            });
            console.log('GTM Event Fired: begin_checkout');
            
            // Προχωράμε στο τελικό βήμα
            document.getElementById('purchase-section').style.display = 'block';
            this.disabled = true;
        });

        // 3. Complete Purchase Action (Redirection)
        document.getElementById('completePurchaseButton').addEventListener('click', function() {
            // Δημιουργία ψεύτικου Transaction ID και Value
            const transactionId = 'T-' + Math.floor(Math.random() * 1000000);
            
            // Ανακατεύθυνση στο submit_form.html, μεταφέροντας τις απαραίτητες παραμέτρους
            // Το τελικό event 'purchase' θα πυροδοτηθεί στο submit_form.html
            window.location.href = `submit_form.html?transaction_id=${transactionId}&value=150.00`;
        });
    </script>
</body>
</html>
